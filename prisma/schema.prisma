generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
    url      = env("DATABASE_URL")
}

// ===============================================
// ENUM GÊNERO
// ===============================================
enum Gender {
  MASCULINO
  FEMININO
}

// ===============================================
// MEMBRO (Member)
// Contém informações básicas e de autenticação do membro.
// ===============================================
model Member {
  id             Int       @id @default(autoincrement())
  name           String    // Nome completo do membro
  email          String?   @unique // E-mail (opcional, mas único)
  username       String?   @unique // Nome de usuário para login
  password       String?   // Senha (o hash da senha deve ser armazenado aqui)
  phone          String?   // Telefone
  birthDate      DateTime? // Data de nascimento
  gender         Gender?   // Gênero do membro
  isActive       Boolean   @default(true) // Indica se o membro está ativo
  createdAt      DateTime  @default(now()) // Data de cadastro

  // Relacionamentos
  ministries        MemberMinistry[]
  societies         MemberSociety[]
  bibleSchoolClassId Int?
  bibleSchoolClass BibleSchoolClass? @relation(fields: [bibleSchoolClassId], references: [id])

  council           MemberCouncil?
  diaconate         MemberDiaconate?

  attendances       Attendance[]
  teachingAssignments ClassTeacher[] @relation(name: "TeachingAssignments")
}

// ===============================================
// CONSELHO (Council)
// ===============================================
model Council {
  id            Int @id @default(1)
  members       MemberCouncil[]
  finances      Finance[] // Relação com o registro financeiro
}

// ===============================================
// DIACONIA (Diaconate)
// ===============================================
model Diaconate {
  id            Int @id @default(1)
  members       MemberDiaconate[]
}

// ===============================================
// RELAÇÃO MEMBRO ↔ CONSELHO (MemberCouncil)
// Tabela de junção para membros do Conselho.
// ===============================================
model MemberCouncil {
  id         Int @id @default(autoincrement())
  memberId   Int @unique
  councilId  Int

  member     Member  @relation(fields: [memberId], references: [id])
  council    Council @relation(fields: [councilId], references: [id])
}

// ===============================================
// RELAÇÃO MEMBRO ↔ DIACONIA (MemberDiaconate)
// Tabela de junção para membros da Diaconia.
// ===============================================
model MemberDiaconate {
  id          Int @id @default(autoincrement())
  memberId    Int @unique
  diaconateId Int

  member      Member    @relation(fields: [memberId], references: [id])
  diaconate   Diaconate @relation(fields: [diaconateId], references: [id])
}

// ===============================================
// MINISTÉRIOS (Ministry)
// ===============================================
model Ministry {
  id        Int    @id @default(autoincrement())
  name      String // Nome do ministério
  members   MemberMinistry[]
}

// Tabela de junção para membros de ministérios.
model MemberMinistry {
  id           Int @id @default(autoincrement())
  memberId     Int
  ministryId   Int

  member       Member   @relation(fields: [memberId], references: [id])
  ministry     Ministry @relation(fields: [ministryId], references: [id])

  @@unique([memberId, ministryId])
}

// ===============================================
// SOCIEDADES INTERNAS (InternalSociety)
// ===============================================
model InternalSociety {
  id            Int    @id @default(autoincrement())
  name          String // Nome da sociedade
  members       MemberSociety[]
  finances      Finance[] // Relação com o registro financeiro
  events        Event[]
}

// Tabela de junção para membros de sociedades.
model MemberSociety {
  id          Int @id @default(autoincrement())
  memberId    Int
  societyId   Int

  member      Member        @relation(fields: [memberId], references: [id])
  society     InternalSociety @relation(fields: [societyId], references: [id])

  @@unique([memberId, societyId])
}

// ===============================================
// ESCOLA BÍBLICA (BibleSchool)
// ===============================================
model BibleSchool {
  id      Int @id @default(1)
  // CORREÇÃO 2: Adicionado nome da relação
  classes BibleSchoolClass[] @relation(name: "BibleSchoolClasses")
}

// ===============================================
// CLASSES DA ESCOLA BÍBLICA (BibleSchoolClass)
// ===============================================
model BibleSchoolClass {
  id        Int    @id @default(autoincrement())
  name      String // Nome da classe

  members   Member[]
  teachers  ClassTeacher[]

  // CORREÇÃO 3: Relação inversa para BibleSchool
  bibleSchoolId Int?
  bibleSchool BibleSchool? @relation(name: "BibleSchoolClasses", fields: [bibleSchoolId], references: [id])
}

// ===============================================
// PROFESSORES DA CLASSE (ClassTeacher)
// Tabela de junção para professores de classes.
// ===============================================
model ClassTeacher {
  id        Int @id @default(autoincrement())
  memberId  Int
  classId   Int

  // CORREÇÃO 4: Adicionado nome da relação
  member    Member            @relation(fields: [memberId], references: [id], name: "TeachingAssignments")
  class     BibleSchoolClass @relation(fields: [classId], references: [id])

  @@unique([memberId, classId])
}

// ===============================================
// EVENTOS / PROGRAMAÇÕES (Event)
// ===============================================
model Event {
  id          Int      @id @default(autoincrement())
  title       String
  description String?
  date        DateTime
  startTime   DateTime?
  endTime     DateTime?
  isPublic    Boolean  @default(false)

  societyId   Int?
  society     InternalSociety? @relation(fields: [societyId], references: [id])

  attendances Attendance[]
}
// ===============================================
// PRESENÇA (Attendance)
// Registro de presença em eventos e classes.
// ===============================================
model Attendance {
  id        Int @id @default(autoincrement())
  memberId  Int // Membro presente
  eventId   Int? // Evento em que o membro esteve presente

  member    Member  @relation(fields: [memberId], references: [id])
  event     Event?  @relation(fields: [eventId], references: [id])

  isPresent Boolean @default(true) // Se o membro estava presente (pode ser usado para faltas)
}

// ===============================================
// AVISOS (Notice)
// Avisos gerais para todos os membros.
// ===============================================
model Notice {
  id        Int      @id @default(autoincrement())
  title     String   // Título do aviso
  message   String   // Conteúdo do aviso
  createdAt DateTime @default(now()) // Data de criação
}

// ===============================================
// FINANCEIRO (Finance)
// Registro de valores financeiros (caixa, balanço, etc.) para Sociedades e Conselho.
// ===============================================
model Finance {
  id          Int      @id @default(autoincrement())
  month       Int      // Mês (1 a 12)
  year        Int      // Ano
  value       Float    // O valor financeiro registrado (ex: caixa mensal)

  // Relação com Council (opcional)
  councilId   Int?
  council     Council? @relation(fields: [councilId], references: [id])

  // Relação com InternalSociety (opcional)
  societyId   Int?
  society     InternalSociety? @relation(fields: [societyId], references: [id])

  // Garante que só haja um registro financeiro por mês/ano para cada entidade
  @@unique([month, year, councilId])
  @@unique([month, year, societyId])
}
