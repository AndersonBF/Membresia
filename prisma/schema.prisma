generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ===============================================
// ENUM GÊNERO
// ===============================================
enum Gender {
  MASCULINO
  FEMININO
}

// ===============================================
// MEMBRO (Member)
// ===============================================
model Member {
  id        Int       @id @default(autoincrement())
  name      String
  email     String?   @unique
  username  String?   @unique
  password  String?
  phone     String?
  birthDate DateTime?
  gender    Gender?
  isActive  Boolean   @default(true)
  createdAt DateTime  @default(now())

  // Relacionamentos
  ministries    MemberMinistry[]
  societies     MemberSociety[]
  
  bibleSchoolClassId Int?
  bibleSchoolClass   BibleSchoolClass? @relation(fields: [bibleSchoolClassId], references: [id])

  council   MemberCouncil?
  diaconate MemberDiaconate?

  attendances         Attendance[]
  teachingAssignments ClassTeacher[] @relation(name: "TeachingAssignments")
}

// ===============================================
// CONSELHO (Council)
// ===============================================
model Council {
  id       Int             @id @default(1)
  members  MemberCouncil[]
  finances Finance[]
  
  // ✅ NOVO: Documentos do Conselho (Atas, Regimentos)
  documents Document[]
}

// ===============================================
// DIACONIA (Diaconate)
// ===============================================
model Diaconate {
  id      Int               @id @default(1)
  members MemberDiaconate[]

  // ✅ NOVO: Documentos da Diaconia (Relatórios de visitas, etc)
  documents Document[]
}

// ===============================================
// RELAÇÃO MEMBRO ↔ CONSELHO
// ===============================================
model MemberCouncil {
  id        Int @id @default(autoincrement())
  memberId  Int @unique
  councilId Int

  member  Member  @relation(fields: [memberId], references: [id])
  council Council @relation(fields: [councilId], references: [id])
}

// ===============================================
// RELAÇÃO MEMBRO ↔ DIACONIA
// ===============================================
model MemberDiaconate {
  id          Int @id @default(autoincrement())
  memberId    Int @unique
  diaconateId Int

  member    Member    @relation(fields: [memberId], references: [id])
  diaconate Diaconate @relation(fields: [diaconateId], references: [id])
}

// ===============================================
// MINISTÉRIOS (Ministry)
// ===============================================
model Ministry {
  id      Int              @id @default(autoincrement())
  name    String
  members MemberMinistry[]

  // ✅ NOVO: Documentos do Ministério (Escalas, Músicas)
  documents Document[]
}

model MemberMinistry {
  id         Int @id @default(autoincrement())
  memberId   Int
  ministryId Int

  member   Member   @relation(fields: [memberId], references: [id])
  ministry Ministry @relation(fields: [ministryId], references: [id])

  @@unique([memberId, ministryId])
}

// ===============================================
// SOCIEDADES INTERNAS (InternalSociety)
// ===============================================
model InternalSociety {
  id       Int             @id @default(autoincrement())
  name     String
  members  MemberSociety[]
  finances Finance[]
  events   Event[]

  // ✅ NOVO: Documentos da Sociedade (Manuais, Atas)
  documents Document[]
}

model MemberSociety {
  id        Int @id @default(autoincrement())
  memberId  Int
  societyId Int

  member  Member          @relation(fields: [memberId], references: [id])
  society InternalSociety @relation(fields: [societyId], references: [id])

  @@unique([memberId, societyId])
}

// ===============================================
// ESCOLA BÍBLICA (BibleSchool)
// ===============================================
model BibleSchool {
  id      Int                @id @default(1)
  classes BibleSchoolClass[] @relation(name: "BibleSchoolClasses")
}

// ===============================================
// CLASSES DA ESCOLA BÍBLICA (BibleSchoolClass)
// ===============================================
model BibleSchoolClass {
  id   Int    @id @default(autoincrement())
  name String

  members  Member[]
  teachers ClassTeacher[]

  bibleSchoolId Int?
  bibleSchool   BibleSchool? @relation(name: "BibleSchoolClasses", fields: [bibleSchoolId], references: [id])

  // ✅ NOVO: Documentos da Classe (Revistas, Lições)
  documents Document[]
}

// ===============================================
// PROFESSORES DA CLASSE
// ===============================================
model ClassTeacher {
  id       Int @id @default(autoincrement())
  memberId Int
  classId  Int

  member Member           @relation(fields: [memberId], references: [id], name: "TeachingAssignments")
  class  BibleSchoolClass @relation(fields: [classId], references: [id])

  @@unique([memberId, classId])
}

// ===============================================
// EVENTOS / PROGRAMAÇÕES
// ===============================================
model Event {
  id          Int       @id @default(autoincrement())
  title       String
  description String?
  date        DateTime
  startTime   DateTime?
  endTime     DateTime?
  isPublic    Boolean   @default(false)

  societyId Int?
  society   InternalSociety? @relation(fields: [societyId], references: [id])

  attendances Attendance[]
}

// ===============================================
// PRESENÇA (Attendance)
// ===============================================
model Attendance {
  id       Int  @id @default(autoincrement())
  memberId Int
  eventId  Int?

  member Member @relation(fields: [memberId], references: [id])
  event  Event? @relation(fields: [eventId], references: [id])

  isPresent Boolean @default(true)
}

// ===============================================
// AVISOS (Notice)
// ===============================================
model Notice {
  id        Int      @id @default(autoincrement())
  title     String
  message   String
  createdAt DateTime @default(now())
}

// ===============================================
// FINANCEIRO (Finance)
// ===============================================
model Finance {
  id    Int   @id @default(autoincrement())
  month Int
  year  Int
  value Float

  councilId Int?
  council   Council? @relation(fields: [councilId], references: [id])

  societyId Int?
  society   InternalSociety? @relation(fields: [societyId], references: [id])

  @@unique([month, year, councilId])
  @@unique([month, year, societyId])
}

// ===============================================
// DOCUMENTOS (Document) - ✅ NOVO MODELO
// Centraliza arquivos de todas as áreas
// ===============================================
model Document {
  id          Int      @id @default(autoincrement())
  title       String
  description String?
  fileUrl     String   // Caminho do arquivo
  createdAt   DateTime @default(now())

  // Relações Opcionais (Um documento pertence a APENAS UM destes grupos por vez)
  
  societyId   Int?
  society     InternalSociety? @relation(fields: [societyId], references: [id])

  councilId   Int?
  council     Council?         @relation(fields: [councilId], references: [id])

  diaconateId Int?
  diaconate   Diaconate?       @relation(fields: [diaconateId], references: [id])

  ministryId  Int?
  ministry    Ministry?        @relation(fields: [ministryId], references: [id])

  bibleSchoolClassId Int?
  bibleSchoolClass   BibleSchoolClass? @relation(fields: [bibleSchoolClassId], references: [id])
}